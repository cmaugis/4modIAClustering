<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4modIA-Clustering - TP 4 : Classification par modèles de mélanges</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./LogoINSAToulouse.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">4modIA-Clustering</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./TP1-Kmeans-SujetEtudiant.html" rel="" target="">
 <span class="menu-text">TP1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./TP2-DBSCAN-SujetEtudiant.html" rel="" target="">
 <span class="menu-text">TP2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./TP3-CAH-SujetEtudiant.html" rel="" target="">
 <span class="menu-text">TP3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./TP4-MelangesGMM-SujetEtudiant.html" rel="" target="" aria-current="page">
 <span class="menu-text">TP4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./TP5-Velib-SujetEtudiant.html" rel="" target="">
 <span class="menu-text">TP5</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#mélanges-gaussiens" id="toc-mélanges-gaussiens" class="nav-link active" data-scroll-target="#mélanges-gaussiens"><span class="header-section-number">1</span> Mélanges gaussiens</a>
  <ul class="collapse">
  <li><a href="#application-sur-données-simulées-uni-dimensionnelles" id="toc-application-sur-données-simulées-uni-dimensionnelles" class="nav-link" data-scroll-target="#application-sur-données-simulées-uni-dimensionnelles"><span class="header-section-number">1.1</span> Application sur données simulées uni-dimensionnelles</a></li>
  <li><a href="#application-sur-des-données-simulées-dans-mathbbr2" id="toc-application-sur-des-données-simulées-dans-mathbbr2" class="nav-link" data-scroll-target="#application-sur-des-données-simulées-dans-mathbbr2"><span class="header-section-number">1.2</span> Application sur des données simulées dans <span class="math inline">\(\mathbb{R}^2\)</span></a></li>
  <li><a href="#etude-des-données-de-vins" id="toc-etude-des-données-de-vins" class="nav-link" data-scroll-target="#etude-des-données-de-vins"><span class="header-section-number">1.3</span> Etude des données de vins</a></li>
  </ul></li>
  <li><a href="#classification-par-mélanges-pour-données-catégorielles" id="toc-classification-par-mélanges-pour-données-catégorielles" class="nav-link" data-scroll-target="#classification-par-mélanges-pour-données-catégorielles"><span class="header-section-number">2</span> Classification par mélanges pour données catégorielles</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TP 4 : Classification par modèles de mélanges</h1>
<p class="subtitle lead">4modIA / 2025-2026</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>L’objectif de ce TP est d’illustrer les notions abordées autour des modèles de mélanges.</p>
<p>Les librairies R nécessaires pour ce TP :</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-1_ec48402a7de62a61455238794472885e">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rmixmod)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circlize)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mélanges-gaussiens" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Mélanges gaussiens</h1>
<section id="application-sur-données-simulées-uni-dimensionnelles" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="application-sur-données-simulées-uni-dimensionnelles"><span class="header-section-number">1.1</span> Application sur données simulées uni-dimensionnelles</h2>
<p><strong>Question :</strong> A l’aide du code suivant, simulez un jeu de données selon un mélange gaussien en <span class="math inline">\(3\)</span> composantes unidimensionnel. Faites varier les différents paramètres (proportions, moyennes et variances).</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-2_727f309d1afdc9c5076832086938e5ec">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span> ...</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span> ...</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="sc">-</span>a,<span class="dv">0</span>,a) <span class="co"># les moyennes \mu_k</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>sigma<span class="ot">&lt;-</span><span class="fu">c</span>(b,<span class="fl">0.5</span>,b) <span class="co"># les \sigma_k</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>prop<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span> ...</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Z<span class="ot">&lt;-</span><span class="fu">rmultinom</span>(....)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">X=</span><span class="fu">c</span>(<span class="fu">rnorm</span>(...),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rnorm</span>(...),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rnorm</span>(...)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>labeltrue<span class="ot">&lt;-</span>    <span class="co"># vecteur des vrais labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-3_b2bbdeb08f0426b4ca1864861f482112">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>aux<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="sc">-</span>(a<span class="sc">+</span><span class="dv">4</span>),a<span class="sc">+</span><span class="dv">4</span>,<span class="fl">0.01</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x=</span>aux,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">y1=</span>(prop[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dnorm</span>(aux,mu[<span class="dv">1</span>],sigma[<span class="dv">1</span>])), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">y2=</span>(prop[<span class="dv">2</span>]<span class="sc">*</span><span class="fu">dnorm</span>(aux,mu[<span class="dv">2</span>],sigma[<span class="dv">2</span>])),     </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">y3=</span>(prop[<span class="dv">3</span>]<span class="sc">*</span><span class="fu">dnorm</span>(aux,mu[<span class="dv">3</span>],sigma[<span class="dv">3</span>])))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>gvrai<span class="ot">&lt;-</span><span class="fu">ggplot</span>(X,<span class="fu">aes</span>(<span class="at">x=</span>X))<span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)),<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y1),<span class="at">data=</span>Y,<span class="at">col=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y2),<span class="at">data=</span>Y,<span class="at">col=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y3),<span class="at">data=</span>Y,<span class="at">col=</span><span class="st">"green"</span>)<span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>gvrai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Estimez les paramètres d’un mélange à <span class="math inline">\(K=3\)</span> classes à l’aide de la fonction <code>Mclust()</code> de la librairie <code>mclust</code>. Comparez la classification obtenue avec les vrais labels.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-4_29c262a2f86e58fbe71fcfbfc3a9267c">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A completer</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">Mclust</span>(...)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(...,...)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustedRandIndex</span>(...,...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Représentez la densité de mélange estimée sur l’histogramme de l’échantillon simulé. Vous pouvez vous aider de la fonction <code>dnorm()</code> appliquée avec les différentes estimations de paramètres par composante.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-5_3a79551306767f18e637b3185ddfa133">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A completer</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dans y_k &lt;- \pi_k \times \phi(x; \mu_k,\sigma_k^2)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>MelEstim<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x=</span>aux,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y1=</span>....., </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y2=</span>.....,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y3=</span>......)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>MelEstim<span class="ot">&lt;-</span><span class="fu">data.frame</span>(MelEstim,<span class="at">Somme=</span><span class="fu">apply</span>(MelEstim[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>],<span class="dv">1</span>,sum))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>gMelEst<span class="ot">&lt;-</span><span class="fu">ggplot</span>(X,<span class="fu">aes</span>(<span class="at">x=</span>X))<span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)),<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y1),<span class="at">data=</span>MelEstim,<span class="at">col=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y2),<span class="at">data=</span>MelEstim,<span class="at">col=</span><span class="st">"green4"</span>)<span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y3),<span class="at">data=</span>MelEstim,<span class="at">col=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>Somme),<span class="at">data=</span>MelEstim,<span class="at">col=</span><span class="st">"yellow"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth=</span><span class="fl">1.5</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>gMelEst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Calculez les probabilités a posteriori d’appartenance des individus à chacune des trois classes et tracez-les graphiquement.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-6_8e4059b43d2bac8364a17f09f07a101d">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dans p mettre le vecteur des proba a posteriori d'appartenance (t_{11},\ldots,t_{n1},t_{12},\ldots,t_{n3})</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>MelProba<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">rep</span>(aux,<span class="dv">3</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">p=</span> <span class="fu">c</span>(..., ..., ..),    </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">class=</span><span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">each=</span><span class="fu">length</span>(aux))))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>gprobapost<span class="ot">&lt;-</span><span class="fu">ggplot</span>(MelProba,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>p,<span class="at">col=</span>class))<span class="sc">+</span><span class="fu">geom_line</span>()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>gprobapost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Tracez les boxplots des probabilités d’appartenance maximales par classe. Vous pouvez vous aider de la fonction <code>apply()</code>.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-7_d7cc33b066848987c1caabad75e90481">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">lab=</span>...,<span class="at">probamax=</span>...)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>gprobamax<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>lab,<span class="at">y=</span>probamax))<span class="sc">+</span><span class="fu">geom_boxplot</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(gvrai,gMelEst,gprobapost,gprobamax,<span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="application-sur-des-données-simulées-dans-mathbbr2" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="application-sur-des-données-simulées-dans-mathbbr2"><span class="header-section-number">1.2</span> Application sur des données simulées dans <span class="math inline">\(\mathbb{R}^2\)</span></h2>
<p>On va ici utiliser les données simulées “ex4.1” disponibles dans la librairie <code>mclust</code>. Ces données sont simulées selon un mélange de densités gaussiennes, proposées dans Baudry et al (2010). L’objectif est d’étudier l’impact du choix des formes des mélanges considérées et de la différence d’objectif entre les critères BIC et ICL. On va au travers de ce jeu de données simulées simple appréhender la manipulation des fonctions pour le clustering par mélanges gaussiens avec R.</p>
<p>On commence ici par charger les données :</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-8_3ec90cf8d5a6f9a6fc187b5bdb116063">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Baudry_etal_2010_JCGS_examples)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Data<span class="ot">&lt;-</span>ex4<span class="fl">.1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Data,<span class="fu">aes</span>(<span class="at">x=</span>X1,<span class="at">y=</span>X2))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP4-MelangesGMM-SujetEtudiant_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="mélanges-gaussiens-diagonaux" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="mélanges-gaussiens-diagonaux"><span class="header-section-number">1.2.1</span> Mélanges gaussiens diagonaux</h3>
<p>Dans cette section, on va considérer une collection de modèles de mélanges gaussiens avec un nombre de composantes <span class="math inline">\(K\)</span> variant entre <span class="math inline">\(2\)</span> et <span class="math inline">\(10\)</span> et des matrices de variance-covariance diagonales.</p>
<p><strong>Question :</strong> A l’aide de la fonction <code>Mclust()</code>, estimez les paramètres des mélanges gaussiens considérés. Vous pouvez consulter l’aide de la fonction <code>mclustModelNames()</code> pour le choix des formes des mélanges.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-9_5fbb6886d3d63539d461cad7d176e078">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A COMPLETER</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>resBICdiag<span class="ot">&lt;-</span><span class="fu">Mclust</span>(....)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> A l’aide de la fonction <code>fviz_mclust_bic()</code>, visualisez le comportement du critère BIC sur la collection de modèles. Quel modèle est sélectionné ? Contrôlez à l’aide de <code>summary(resBICdiag)</code>.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-10_ef9996ae4774c42dcaaea9a2b2edc725">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_mclust</span>(....,<span class="at">what=</span>....)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resBICdiag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Tracez la classification obtenue sur le nuage de points (vous pouvez utiliser la fonction <code>fviz_cluster()</code>). Comment est obtenue cette classification à partir du mélange gaussien retenu ? Quels sont les effectifs par classe ? Contrôlez les probabilités a posterori d’appartenance.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-11_747646f8d3b301d119fa9fabe40fcdce">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation du clustering</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(...)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Effectifs par classe</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(....)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot des probabilités a posteriori maximales</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>Aux<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">label=</span>...,    <span class="at">proba=</span>...)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Aux,<span class="fu">aes</span>(<span class="at">x=</span>label,<span class="at">y=</span>proba))<span class="sc">+</span><span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Quel mélange gaussien est retenu avec le critère ICL ? Vous utiliserez la fonction <code>mclustICL()</code>. Etudiez la classification alors déduite.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-12_fae4a7b530d56d3001931d4a1460da48">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>resICL<span class="ot">&lt;-</span><span class="fu">mclustICL</span>(...)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resICL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="toutes-les-formes-de-mélanges-gaussiens" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="toutes-les-formes-de-mélanges-gaussiens"><span class="header-section-number">1.2.2</span> Toutes les formes de mélanges gaussiens</h3>
<p><strong>Question :</strong> Reprenez les questions de la section précédente en considérant ici toutes les formes de mélanges gaussiens. Commentez.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-13_db6f45e709f1fe0f1a1b0e750bd7213f">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A COMPLETER</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="etude-des-données-de-vins" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="etude-des-données-de-vins"><span class="header-section-number">1.3</span> Etude des données de vins</h2>
<p>On reprend dans ce TP les données <code>wine</code> disponibles sur la page moodle du cours. On charge ici les données.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-14_f7bb39a3b91fb75afd293bacc8aa74e1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wine<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="st">"wine.txt"</span>,<span class="at">header=</span>T)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>wine<span class="sc">$</span>Qualite <span class="ot">=</span> <span class="fu">as.factor</span>(wine<span class="sc">$</span>Qualite)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>wine<span class="sc">$</span>Type <span class="ot">=</span> <span class="fu">factor</span>(wine<span class="sc">$</span>Type, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"blanc"</span>, <span class="st">"rouge"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>wineinit<span class="ot">&lt;-</span>wine</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>wine[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]<span class="ot">&lt;-</span><span class="fu">scale</span>(wine[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">center=</span>T,<span class="at">scale=</span>T)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Qualite  Type      AcidVol    AcidCitr     SO2lbr      SO2tot     Densite
1352  medium rouge  1.638714588 -1.92626362 -1.2083376 -1.15967786 -0.46497450
5493  medium blanc -0.068544417 -1.35617574 -0.7004747 -0.85707581 -0.33499781
5153  medium blanc -0.800226847 -0.59605856  0.5409681 -0.02047014  1.32391517
5308  medium blanc -0.007570881  0.92417581  1.7824108  1.27893867  1.08790487
3866  medium blanc  0.419243870  0.03737243 -0.5311870  0.99413674  0.03783006
694   medium rouge  0.785085086  0.03737243 -0.4747578  0.19313131  1.27260858
          Alcool
1352  1.14546909
5493 -1.12092616
5153 -1.29526426
5308 -1.29526426
3866  0.09944051
694  -0.94658806</code></pre>
</div>
</div>
<p>On fait une ACP pour la visualisation des résultats dans la suite</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-15_7fc76fdfbaa0f22aeda5c6da6188aed6">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resacp<span class="ot">&lt;-</span><span class="fu">PCA</span>(wine,<span class="at">quali.sup=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">scale.unit =</span> <span class="cn">TRUE</span>,<span class="at">graph=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Question :</strong> Déterminez une classification de ces données à l’aide d’un modèle de mélange. Comparez votre résultat avec les classifications obtenues dans les TP précédents (avec Kmeans, CAH).</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-16_7f6a34138ae95724d092c3feae6b34d1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A FAIRE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="classification-par-mélanges-pour-données-catégorielles" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Classification par mélanges pour données catégorielles</h1>
<p>Dans cette partie, on souhaite obtenir une classification des animaux du jeu de données zoo à l’aide de modèles de mélanges. On reprend donc le jeu de données et on refait une analyse en composantes multiples pour la visualisation des résultats.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-17_d0ed33960dd07d1711698a89459dfac3">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>zoo<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="st">"zoo-dataTP.txt"</span>,<span class="at">header=</span>T,<span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(zoo))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  zoo[,j]<span class="ot">&lt;-</span><span class="fu">as.factor</span>(zoo[,j])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> hair   feathers eggs   milk   airbone aquatic predator toothed backbone
 0:58   0:81     0:42   0:60   0:77    0:65    0:45     0:40    0:18    
 1:43   1:20     1:59   1:41   1:24    1:36    1:56     1:61    1:83    
                                                                        
                                                                        
                                                                        
                                                                        
 breathes venomous fins   legs   tail   domestic catsize
 0:21     0:93     0:84   0:23   0:26   0:88     0:57   
 1:80     1: 8     1:17   2:27   1:75   1:13     1:44   
                          4:38                          
                          5: 1                          
                          6:10                          
                          8: 2                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 101  16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>res.mca<span class="ot">&lt;-</span> <span class="fu">MCA</span>(zoo,<span class="at">ncp =</span> <span class="dv">5</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_mca_ind</span>(res.mca,<span class="at">repel=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TP4-MelangesGMM-SujetEtudiant_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pour la suite du TP, on pourra utiliser les fonctions auxiliaires suivantes. La fonction <code>barplotClus()</code> permet de tracer la répartition des modalités de variables qualitatives pour chaque classe d’un clustering donné.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-18_90328fe3dae695cbfb61547d29ffe1af">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># J indice des variables</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Data = jeu de données</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># clust = clustering étudié</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># output : liste des graphes par variable dans J donnant la répartition des modalités de J par classe de clust</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>barplotClus <span class="ot">&lt;-</span> <span class="cf">function</span>(clust, Data, J) {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    aux.long.p <span class="ot">&lt;-</span> <span class="fu">heatm</span>(clust, Data, J)<span class="sc">$</span>freq</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    p<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(J)) {</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        p[[j]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(aux.long.p[<span class="fu">which</span>(aux.long.p<span class="sc">$</span>variable <span class="sc">==</span> <span class="fu">colnames</span>(Data)[J[j]]), ],</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> clust, <span class="at">y =</span> perc, <span class="at">fill =</span> value)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">fill =</span> <span class="fu">colnames</span>(Data)[J[j]])</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>heatm <span class="ot">&lt;-</span> <span class="cf">function</span>(clust, Data, J) {</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dplyr)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    Dataaux <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id.s =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Data)), Data)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    aux <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Dataaux, clust)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    aux.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="fu">data.frame</span>(<span class="fu">lapply</span>(aux, as.character)), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"id.s"</span>, <span class="st">"clust"</span>), <span class="at">factorsAsStrings =</span> T)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Effectifs</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    aux.long.q <span class="ot">&lt;-</span> aux.long <span class="sc">%&gt;%</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(clust, variable, value) <span class="sc">%&gt;%</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">n_distinct</span>(id.s)) <span class="sc">%&gt;%</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distinct</span>(clust, variable, value, count)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># avec fréquences</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    aux.long.p <span class="ot">&lt;-</span> aux.long.q <span class="sc">%&gt;%</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(clust, variable) <span class="sc">%&gt;%</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">perc =</span> count<span class="sc">/</span><span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(clust)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    Lev <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(Data)) Lev <span class="ot">&lt;-</span> <span class="fu">c</span>(Lev, <span class="fu">levels</span>(Data[, j]))</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    Jaux <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(J)) {</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>        Jaux <span class="ot">&lt;-</span> <span class="fu">c</span>(Jaux, <span class="fu">which</span>(aux.long.p<span class="sc">$</span>variable <span class="sc">==</span> <span class="fu">colnames</span>(Data)[J[j]]))</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    gaux <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(aux.long.p[Jaux, ], <span class="fu">aes</span>(<span class="at">x =</span> clust, <span class="at">y =</span> value)) <span class="sc">+</span> <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> perc)) <span class="sc">+</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">mid =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">gaux =</span> gaux, <span class="at">eff =</span> aux.long.q, <span class="at">freq =</span> aux.long.p))</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous allons utiliser une stratégie de classification via des modèles de mélange. Rappelons que l’on a pour données <span class="math inline">\(\mathbf{X}=(x_1,\ldots,x_n)\)</span> avec <span class="math inline">\(x_i\)</span> décrit par <span class="math inline">\(p\)</span> variables catégorielles, chacune avec <span class="math inline">\(m_j\)</span> modalités. Dans ce cas de variables qualitatives, on peut considérer des distributions multinomiales par variable et par composante. Pour écrire la distribution de mélange, on commence par transformer l’écriture des données de la façon suivante :</p>
<p><span class="math display">\[x_i=(x_{i1},\ldots,x_{ip})\rightsquigarrow (x_i^{jh}; j=1,\ldots,p, h=1,\ldots,m_j)\]</span> avec <span class="math display">\[
  x_i^{\,jh}=\left\{\begin{array}{l l}1 &amp; \textrm{ si } i \textrm{ prend la modalité } h  \textrm{ pour la variable }j\\
                                      0 &amp; \textrm{ sinon.}\end{array}\right.
\]</span> Les densités de mélange considérées sont de la forme <span class="math display">\[f(.|\theta_K)=\underset{k=1}{\stackrel{K}{\sum}}\pi_k f_k(x_i|\boldsymbol{\alpha}_k)\]</span> avec</p>
<ul>
<li><p><span class="math inline">\(f_k(x_i|\boldsymbol{\alpha}_k)=\underset{j=1}{\stackrel{p}{\prod}}\underset{h=1}{\stackrel{m_j}{\prod}}\left(\alpha_k^{\,jh}\right)^{x_i^{jh}}\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{\alpha}_k=(\alpha_k^{\,jh}; j=1,\ldots,p, h=1,\ldots,m_j)\)</span> avec <span class="math inline">\(\underset{h=1}{\stackrel{m_j}{\sum}}\alpha_k^{jh}=1\)</span></p></li>
<li><p><span class="math inline">\(\theta_k=(\pi_1,\ldots,\pi_K,\boldsymbol{\alpha}_1,\ldots,\boldsymbol{\alpha}_K)\)</span></p></li>
</ul>
<p>Classiquement, on reparamétrise par</p>
<ul>
<li>Pour chaque classe <span class="math inline">\(k\)</span> et chaque variable <span class="math inline">\(j\)</span> <span class="math display">\[(\alpha_k^{\ j1},\ldots,\alpha_k^{\ jm_j}) \rightarrow (a_k^{\ j1},\ldots,a_k^{\ jm_j},\varepsilon_k^{\ j1},\ldots,\varepsilon_k^{\ jm_j})\]</span> avec <span class="math display">\[
a_k^{\ jh}=\left\{\begin{array}{l l}1 &amp; \textrm{ si } h=\underset{h'=1,\ldots,m_j}{\mbox{argmax}}\ \alpha_k^{\ jh'}\\
                                 0 &amp; \textrm{sinon}\end{array}\right.
\]</span> (<span class="math inline">\(h\)</span>= modalité majoritaire pour variable <span class="math inline">\(j\)</span> dans classe <span class="math inline">\(k\)</span>) et</li>
</ul>
<p><span class="math display">\[
\varepsilon_{k}^{\ jh}=\left\{\begin{array}{l l}1 - \alpha_k^{\ jh} &amp; \textrm{ si } a_k^{\ jh}=1\\
                                   \alpha_k^{\ jh} &amp; \textrm{ si } a_k^{\ jh}=0\end{array}\right.
\]</span></p>
<p>Par exemple <span class="math inline">\((0.3,0.6,0.1) \rightsquigarrow (0,1,0,\ \ 0.3,0.4,0.1)\)</span></p>
<p>La densité de mélange se réécrit alors <span class="math display">\[f(.|\theta_K)=\underset{k=1}{\stackrel{K}{\sum}}\pi_k \underset{j=1}{\stackrel{p}{\prod}}\underset{h=1}{\stackrel{m_j}{\prod}} \left[\left(1-\varepsilon_k^{\,jh}\right)^{a_k^{\ jh}} \left(\varepsilon_k^{\,jh}\right)^{1-a_k^{\ jh}}\right]^{x_i^{jh}}\]</span></p>
<p>Selon les hypothèses faites sur les <span class="math inline">\(\varepsilon_{k}^{\ jh}\)</span> et sur les proportions du mélange, on a 10 formes possibles (dans le même esprit que les différentes formes des mélanges gaussiens, cf cours).</p>
<p><strong>Question :</strong> A l’aide de la fonction <code>mixmodCluster</code> de la librairie <code>Rmixmod</code>, déterminez une classification des données par modèles de mélange. Vous étudierez en particulier les probabilités conditionnelles d’appartenance. Vous pouvez tester plusieurs formes de mélange.</p>
<div class="cell" data-hash="TP4-MelangesGMM-SujetEtudiant_cache/html/unnamed-chunk-19_5ac6cb5736c5d6b01a7f818f61a4123c">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rmixmod)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>resmixmod<span class="ot">&lt;-</span><span class="fu">mixmodCluster</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> zoo, <span class="at">nbCluster =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">"BIC"</span>, <span class="st">"ICL"</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">mixmodMultinomialModel</span>(<span class="st">"Binary_pk_Ekjh"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphe des critères de sélection</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>K<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>BIC<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ICL<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(resmixmod<span class="sc">@</span>results)){</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  K<span class="ot">&lt;-</span><span class="fu">c</span>(K,resmixmod<span class="sc">@</span>results[[k]]<span class="sc">@</span>nbCluster)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  BIC<span class="ot">&lt;-</span><span class="fu">c</span>(BIC,resmixmod<span class="sc">@</span>results[[k]]<span class="sc">@</span>criterionValue[<span class="dv">1</span>])</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  ICL<span class="ot">&lt;-</span><span class="fu">c</span>(ICL,resmixmod<span class="sc">@</span>results[[k]]<span class="sc">@</span>criterionValue[<span class="dv">2</span>])</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="do">## graphique à faire</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Etude de la classification retenue</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">proba=</span><span class="fu">apply</span>(resmixmod<span class="sc">@</span>bestResult<span class="sc">@</span>proba,<span class="dv">1</span>,max),</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">label=</span><span class="fu">as.factor</span>(<span class="fu">apply</span>(resmixmod<span class="sc">@</span>bestResult<span class="sc">@</span>proba,<span class="dv">1</span>,which.max)))</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>label,<span class="at">y=</span>proba))<span class="sc">+</span><span class="fu">geom_boxplot</span>()</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(resmixmod<span class="sc">@</span>bestResult<span class="sc">@</span>partition)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="do">## A completer</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaison avec les autres classifications</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="do">## A completer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>